---
title: "Linear model_a17nodulecounts1"
author: "sohini guha"
date: '2022-10-31'
output: html_document
---
---
title: "Sohini's first rmd"
output: html_document
date: '2022-10-17'
---

```{r setup, include=FALSE}
#
knitr::opts_chunk$set(echo = TRUE)

#Set up all the packages you will need. Tidyverse include dplyer
require(tidyverse)
require(ggpubr)

knitr::opts_chunk$set(message = FALSE)
```
import the data

One of the nice things about GitHub and R is that if you open up your file from the folder all the paths should be all set up. See if this code works for you. Is so then we don't have to deal with any complicated paths to collaboratively work together

I found a couple of other Problems with the original code 
1) The data file is not a .csv file. It is a text delimited file so you didn't have the right file path. 
2) I switched over to useing the read.table function which I think is easier for text files.
3) The genotype file was causing issues because someone added a website name to the bottom of the text file so it was not reading into R correctly. I went back to the original file and deleted the extra text. Now the join works.

Sohini you asked about how can we remove all the non essential backgrounds at one go? You do this by using the double equals (==) instead of the (!=) in the filtering step

```{r Importing Data and Running a Linear Model, echo=TRUE}

# Import the text file of nodule data
data_HostMutants2021_nod_counts <- read.table("../data/data_HostMutants2021_nod_counts.txt",sep = "\t",header=TRUE)

# Import the genotype information data
genotype_name <- read.table("../data/genotype_name.txt",sep = "\t",header=TRUE)

#convert the genotype_id into integer
genotype_name$genotype_id = as.integer(genotype_name$genotype_id)

#merge the two data set by 'genotype_id'
all.data<- full_join (data_HostMutants2021_nod_counts, genotype_name, by = "genotype_id")

#Select for only the A17 background 
all.data.A17 <- all.data %>% filter(background=="A17")

# Remove two genotypes that did not survive/form nodules... Use the '!=' this time which says to grab all of the them BUT the named genotype ID.
all.data.A17 <- all.data.A17 %>% filter(genotype_id!="853")
all.data.A17 <- all.data.A17 %>% filter(genotype_id!="838")
```
Okay now we are ready to run a linear model with all 3 predictors!
```{r Running a Linear Model, echo=TRUE}
# running the linear model
model <- lm(Count ~ genotype_id + rep + type, data = all.data.A17)
summary(model)
```
Right now genotype_ID only has a single co-efficient. That is because Genotype_ID is a number not a factor. We can use the column "name"" instead. We also need to make sure R understands it is a factor not a character or number!
```{r Running a Linear Model take two, echo=TRUE}

all.data.A17$name 
#Note that this currently is a character. We need to turn it into a factor.
all.data.A17$name<-factor(all.data.A17$name)

#We need to do the same thing with type
all.data.A17$type<-factor(all.data.A17$type, levels = c("WT","Early","Late","AON"))

# Now run the model
model1 <- lm(Count ~ name + rep + type, data = all.data.A17)
summary(model1)
```
Hmmm that is weird why do you think we are getting NA's for type?

Basicaly is because the genotypes are completely nested within each type and thus they are not independent predictors. If we wanted to be fancy we could create a hierarchal model, but for the moment we are going to stay simple and run two seperate models one with type + rep and the other with name + rep

```{r Running a Linear Model on name alone, echo=TRUE}
# Run a model with name and replicate as predictors
model.name <- lm(Count ~ name + rep, data = all.data.A17)

#Examine the summary
summary(model.name)

#Examine the Analysis of Variance table
q<-anova(model.name)
q
# percentage of variance explained
q<-q$"Sum Sq"
print(cbind(PctExp=q/sum(q)*100))
```

Sohini-- type your intertation of these model results here:
The genotypes influence the nodule number trait significantly( Pr(>F)=1.427e-12) while the technical replicates have no significant effect( Pr(>F)=0.6444).Among the genotypes, the dmi's have the most pronounced effect on nodulation.None of the dmi nodulated during community inoculation indicating their absolute essentiality. latd also had a similar strong negative effect on nodulation. Among the genotypes which positively influenced nodule numbers, rdn1 and sunn4 were strong candidates with sunn4 emerging to be most influential among all the genotypes tested.  Lastly, among the dnfs, only dnf6 seems to positively affect the trait while the rest had minor/non-significant effects.

```{r Running a Linear Model on type alone, echo=TRUE}
# Run a model with type and replicate as predictors
model.type <- lm(Count ~ type + rep, data = all.data.A17)

#Examine the summary
summary(model.type)

#Examine the Analysis of Variance table
p<-anova(model.type)
p
# percentage of variance explained
p<-p$"Sum Sq"
print(cbind(PctExp=p/sum(p)*100))
```
Sohini type your interpretation of the model results here:
Here also the technical replicates did not affect the overall nodule numbers. The stage of nodulation strongly influenced the nodule numbers (Pr(>F) =4.916e-14),specifically the Early stage of nodulation (latd).It seems as if any mutation in the early stage of RNS negatively affects the nodule numbers. Autoregulation of nodulation pathway(AON) (rdn1,sunn4) is a significant positive influencer of nodulation.

```{r Data visualization by name, echo=TRUE}
#Super quick base r plot!
plot(Count~name, data=all.data.A17)
```

```{r Data visualization by Type, echo=TRUE}
#Super quick base r plot!
plot(Count~type, data=all.data.A17)
```

