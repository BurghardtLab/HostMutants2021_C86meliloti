---
title: "NSFPGRP_HostMutant_C86Meliloti"
author: Regina B. Bledsoe, Liana T. Burghardt, ... 
output: html_notebook
---

Analysis file for NSF Host Mutant C86 Ensifer meliloti select and resequence project. 

```{r, setup, include=FALSE}
#This chunk is for setting global options for all chunks
knitr::opts_knit$set(root.dir = '/GitHub')
knitr::opts_chunk$set(message = FALSE)

#Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

#When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

#The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

#To display output in the plots pane Preferences>> OR Tools>>Global_Options>> RMarkdown>>uncheck "Show output inline...")

#Searchable R Markdown reference: https://bookdown.org/yihui/rmarkdown-cookbook/

#Code that may once again be useful

#Combining plots
#require(ggpubr)
#cfu_combo <- ggarrange(p_cfu_A17, p_cfu_R108, common.legend = TRUE)

#facet zoom
#facet_grid(. ~ background) 
#facet_zoom(ylim = c(1000000, 10000000)) #require(ggforce)) 
```

```{r load require libraries, echo=FALSE, results='hide',include=FALSE}
require(tidyverse)
require(ggpubr)

#color palettes - colorblind friendly
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
cbbPalette <- c("#E69F00", "#D55E00","56B4E9" , "#CC79A7", "#009E73", "#0072B2","#F0E442" , "#000000")
```

```{r load data files, include=FALSE}
getwd()
all_data <- read.table("../data/data_nsfpgrp_hostmutants_C86meliloti.txt", sep = "\t", header=TRUE)
geno_name <- read.table("../data/genotype_name.txt", sep = "\t", header=TRUE)

#genotype_id imports as a chr... not sure why but it is int in the all_data table
geno_name$genotype_id = as.integer(geno_name$genotype_id)
#Calculate cfu per plant - divide by 4ml (this is the amount added to nodules to homogenize) then divide by number of plants picked nodules from to get cfu/ml to cfu/plant
#drop_na(num_plants_picked_nods) %>%
all_data <- all_data %>% inner_join(geno_name, by="genotype_id") %>%  mutate(cfu_plant = cfu_ml/4/num_plants_picked_nods, above_plant = above_biomass_g/num_plants, below_plant = below_biomass_g/num_plants, root_shoot = below_plant/above_plant, nod_wt_plant = nodule_weight_g/num_plants_picked_nods, tot_biomass = above_biomass_g + below_biomass_g)

#num_plants_picked_nods for nodule metrics and 
#num_plants for whole plant metrics ie biomass

#Filter out unwanted samples hybrids and unknown genotypes
all_data <- all_data %>% filter(type!="A18") %>% filter(type!="UN") 
#set genotype_id as a factor so will group in plots
all_data$genotype_id = as.factor(all_data$genotype_id)
```
<b>Summary</b>


<b>Results for dilution plating of nodule homogenate.</b> <br/>
(1)Variation among backgrounds and genotypes. (2) Sunn1, Sunn4 are highly numerated with nodules. (3) A17 and R108 wild types show trend that A17 has higher rhizobial load than R108.

This plot depicts cfu per plant for each genotype. 
```{r plate counts by name, echo=FALSE}
#By host genotype
p_cfu<-ggplot(all_data, aes(x=reorder(name,order), y=cfu_plant)) +
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=cfu_plant, color=type)) +
        scale_y_continuous(trans='log10') +
        labs(x="Plant Genotype",y="log(cfus per plant)")+
        coord_flip() +
        scale_color_manual(values = cbPalette) +
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_cfu

#If want separate plots for plant backgrounds. Copy and paste plot code from above below the data line here.
#p_cfu_A17<-ggplot(filter(all_data, background!="R108"), aes(x=reorder(name,order), y=cfu_plant)) +
#p_cfu_R108<-ggplot(filter(all_data, background=="R108"), aes(x=reorder(name,order), y=cfu_plant)) + 

ggsave(plot = p_cfu , width = 10, height = 7, dpi = 600, filename = "../figures/cfu_geno.png")
```

<b>This plot depicts</b> cfu per plant for each host background which could be Medicago truncatula A17 or R108.  
```{r counts by host background, echo=FALSE}
#By host background
p_bg_cfu<-ggplot(all_data, aes(x=background, y=cfu_plant)) + 
        geom_boxplot(aes(x=background, y=cfu_plant)) +
        geom_jitter(aes(x=background, y=cfu_plant, color=type)) +
        scale_y_continuous(trans='log10') +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        scale_color_manual(values=cbPalette, ) +
        labs(x="Plant Host",y="log(cfus per plant)") +
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_bg_cfu 

#ggsave(plot = p_bg_cfu , width = 5.3, height = 5.5, dpi = 600, filename = "../figures/bg_cfu.png")
```

Above ground biomass in grams per plant by genotype and colored by host background.   
```{r plot above ground, echo=FALSE}
#By host genotype
p_aBiomass<-ggplot(all_data, aes(x=reorder(name,order), y=above_biomass_g)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=above_biomass_g, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Per Plant Above Biomass (g)") +
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_aBiomass 

p_bg_aBiomass<-ggplot(all_data, aes(x=background, y=above_biomass_g)) + 
        geom_boxplot(aes(x=background, y=above_biomass_g)) +
        geom_jitter(aes(x=background, y=above_biomass_g, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Per Plant Above Biomass (g)")+
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_bg_aBiomass 

```

Below ground biomass in grams per plant by genotype and colored by host background.  
```{r plot below ground, echo=FALSE}
#By host genotype
p_bBiomass<-ggplot(all_data, aes(x=reorder(name,order), y=below_biomass_g)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=below_biomass_g, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Per Plant Below Biomass (g)") +
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_bBiomass 

p_bg_bBiomass<-ggplot(all_data, aes(x=background, y=below_biomass_g)) + 
        geom_boxplot(aes(x=background, y=below_biomass_g)) +
        geom_jitter(aes(x=background, y=below_biomass_g, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Per Plant Below Biomass (g)")+
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_bg_bBiomass


#ggsave(plot = biomass_combo , width = 10, height = 10, dpi = 600, filename = "../figures/biomass_combo.png")



```
```{r total biomass, echo=FALSE}
p_tot_biomass<-ggplot(all_data, aes(x=reorder(name,order), y=tot_biomass)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=tot_biomass, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Total Biomass (g)") +
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_tot_biomass 

p_bg_tot_biomass<-ggplot(all_data, aes(x=background, y=tot_biomass)) + 
        geom_boxplot(aes(x=background, y=tot_biomass)) +
        geom_jitter(aes(x=background, y=tot_biomass, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Total Biomass (g)")+
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_bg_tot_biomass
```

Root to shoot ratio in grams per plant by genotype and colored by host background.  
```{r plot shoot_root, echo=FALSE}
#By host genotype
p_root_shoot<-ggplot(all_data, aes(x=reorder(name,order), y=root_shoot)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=root_shoot, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Root:Shoot") +
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_root_shoot 

p_bg_root_shoot<-ggplot(all_data, aes(x=background, y=root_shoot)) + 
        geom_boxplot(aes(x=background, y=root_shoot)) +
        geom_jitter(aes(x=background, y=root_shoot, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Root:Shoot")+
        theme_classic() + theme(legend.position="", text = element_text(size=18))
p_bg_root_shoot


ggsave(plot = p_root_shoot , width = 10, height = 10, dpi = 600, filename = "../figures/root_shoot.png")


```

```{r nodule data load, include=FALSE}
nod_data <- read.table("../data/data_nod_img_measurements.txt", sep = "\t", header=TRUE)
#nod_data$genotype_id = as.factor(nod_data$genotype_id)
all_data <- all_data %>% full_join(nod_data, by="sample_id") %>% mutate(nod_cnt_plant = nod_count/num_plants, tot_area_plant = nod_total_area_cm2/num_plants )

```

```{r nod count per plant, echo=FALSE}
p_nod_cnt <-ggplot(all_data, aes(x=reorder(name,order), y=nod_cnt_plant)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=nod_cnt_plant, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Nods per plant") +
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_nod_cnt 

p_bg_nod_cnt <-ggplot(all_data, aes(x=background, y=nod_cnt_plant)) + 
        geom_boxplot(aes(x=background, y=nod_cnt_plant)) +
        geom_jitter(aes(x=background, y=nod_cnt_plant, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Nods per plant")+
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_bg_nod_cnt
```

```{r total area of nodules, echo=FALSE}
p_tot_area <-ggplot(all_data, aes(x=reorder(name,order), y=tot_area_plant)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=tot_area_plant, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Total Nod Area per plant") +
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_tot_area 

p_bg_tot_area <-ggplot(all_data, aes(x=background, y=tot_area_plant)) + 
        geom_boxplot(aes(x=background, y=tot_area_plant)) +
        geom_jitter(aes(x=background, y=tot_area_plant, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Total Nod area per plant")+
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_bg_tot_area
```
```{r nodule weight, echo=FALSE}
p_nod_wt <-ggplot(all_data, aes(x=reorder(name,order), y=nod_wt_plant)) + 
        geom_boxplot(outlier.shape=NA) +
        geom_jitter(aes(x=name, y=nod_wt_plant, color=type)) +
        coord_flip() +
        scale_color_manual(values=cbPalette)  +
        labs(x="Plant Host",y="Nod gram per plant") +
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_nod_wt 

p_bg_nod_wt <-ggplot(all_data, aes(x=background, y=nod_wt_plant)) + 
        geom_boxplot(aes(x=background, y=nod_wt_plant)) +
        geom_jitter(aes(x=background, y=nod_wt_plant, color=type)) +
        scale_color_manual(values=cbPalette) +
        scale_fill_manual(values=c("#D55E00", "#CC79A7")) +
        labs(x="Plant Host",y="Nod gram per plant")+
        theme_classic() + theme(legend.position="top", text = element_text(size=18))
p_bg_nod_wt
```
